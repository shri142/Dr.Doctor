{% extends "Patient/base.html" %}

{% block content %}
	<style type="text/css">
		.nav-side-menu {
  overflow: auto;
  font-family: verdana;
  font-size: 12px;
  font-weight: 200;
  background-color: #2e353d;
  position: fixed;
  top: 0px;
  width: 300px;
  height: 100%;
  color: #e1ffff;
}
.nav-side-menu .brand {
  background-color: #23282e;
  line-height: 50px;
  display: block;
  text-align: center;
  font-size: 14px;
}
.nav-side-menu .toggle-btn {
  display: none;
}
.nav-side-menu ul,
.nav-side-menu li {
  list-style: none;
  padding: 0px;
  margin: 0px;
  line-height: 35px;
  cursor: pointer;
  /*    
    .collapsed{
       .arrow:before{
                 font-family: FontAwesome;
                 content: "\f053";
                 display: inline-block;
                 padding-left:10px;
                 padding-right: 10px;
                 vertical-align: middle;
                 float:right;
            }
     }
*/
}
.nav-side-menu ul :not(collapsed) .arrow:before,
.nav-side-menu li :not(collapsed) .arrow:before {
  font-family: FontAwesome;
  content: "\f078";
  display: inline-block;
  padding-left: 10px;
  padding-right: 10px;
  vertical-align: middle;
  float: right;
}
.nav-side-menu ul .active,
.nav-side-menu li .active {
  border-left: 3px solid #d19b3d;
  background-color: #4f5b69;
}
.nav-side-menu ul .sub-menu li.active,
.nav-side-menu li .sub-menu li.active {
  color: #d19b3d;
}
.nav-side-menu ul .sub-menu li.active a,
.nav-side-menu li .sub-menu li.active a {
  color: #d19b3d;
}
.nav-side-menu ul .sub-menu li,
.nav-side-menu li .sub-menu li {
  background-color: #181c20;
  border: none;
  line-height: 28px;
  border-bottom: 1px solid #23282e;
  margin-left: 0px;
}
.nav-side-menu ul .sub-menu li:hover,
.nav-side-menu li .sub-menu li:hover {
  background-color: #020203;
}
.nav-side-menu ul .sub-menu li:before,
.nav-side-menu li .sub-menu li:before {
  font-family: FontAwesome;
  content: "\f105";
  display: inline-block;
  padding-left: 10px;
  padding-right: 10px;
  vertical-align: middle;
}
.nav-side-menu li {
  padding-left: 10px;
  border-left: 3px solid #2e353d;
  border-bottom: 1px solid #23282e;
}
.nav-side-menu ul a {
  text-decoration: none;
  color: #e1ffff;
}
.nav-side-menu li a i {
  padding-left: 10px;
  width: 20px;
  padding-right: 20px;
}
.nav-side-menu li:hover {
  border-left: 3px solid #d19b3d;
  background-color: #4f5b69;
  -webkit-transition: all 1s ease;
  -moz-transition: all 1s ease;
  -o-transition: all 1s ease;
  -ms-transition: all 1s ease;
  transition: all 1s ease;
}
.head{

	overflow: hidden;
	background-color: currentColor;
	//position: fixed;
	width: 100%;
	height: 50px;
	//margin-left: 300px;
}
.header-right{
	float: right;
}
#logoutButton{
  height: 50px;
}
.headDropdown{
	color: #EEE;
    background: transparent;
	width: 152px;
	height: 49px;
}
.headDropdown option {
    margin: 40px;
    background: #2e353d;
    color: #fff;

}
.mainContainer{
  background: transparent;
  
  margin-left: 300px;
}
.formContainer{
  background: ;
  float: left;
  //box-shadow: 0 9px 9px silver;
  margin: 0 auto;
  padding-bottom: 33px;
  padding-top: 5px;
  width: 1024px;

}
.custab{
    border: 1px solid #ccc;
    padding: 5px;
    margin: 5% 0;
    box-shadow: 3px 3px 2px #ccc;
    transition: 0.5s;
    }
.custab:hover{
    box-shadow: 3px 3px 0px transparent;
    transition: 0.5s;
    }
    .container{
      background: transparent;
    }
    .rightSection{
      background: ;
      float: right;
      width: 424px;
      height: 366px;
      margin: 0 auto;
      padding: 9px;
    }
    .rightSection .container{
      background: ;
      //box-shadow: 0 9px 9px silver;
    }
    //switch start

  

//switch end

@media (max-width: 767px) {
  .nav-side-menu {
    position: relative;
    width: 100%;
    margin-bottom: 10px;
  }
  .nav-side-menu .toggle-btn {
    display: block;
    cursor: pointer;
    position: absolute;
    right: 10px;
    top: 10px;
    z-index: 10 !important;
    padding: 3px;
    background-color: #ffffff;
    color: #000;
    width: 40px;
    text-align: center;
  }
  .brand {
    text-align: left !important;
    font-size: 22px;
    padding-left: 20px;
    line-height: 50px !important;
  }
  .mainContainer{
    margin-left: 0px;
  }
}
@media (min-width: 767px) {
  .nav-side-menu .menu-list .menu-content {
    display: block;
  }
}
body {
  margin: 0px;
  padding: 0px;
}

	</style>

	<link href="bootstrap.min.css" rel="stylesheet" id="bootstrap-css">

<!------ Include the above in your HEAD tag ---------->

<link href="font-awesome.min.css" rel="stylesheet">

<div class="pageContainer">
    <div class="head">
  <div class="header-right">

    <a href="{% url 'logout' %}"  id="logoutButton" class="btn btn-danger btn-lg">Logout</a>
  </div>
  
</div>
<div class="nav-side-menu">
    <div class="brand">E Prescription</div>
    <i class="fa fa-bars fa-2x toggle-btn" data-toggle="collapse" data-target="#menu-content"></i>
  
        <div class="menu-list">
  
            <ul id="menu-content" class="menu-content collapse out">
                <li class="">
                  <a href="#">
                  <i class="fa fa-dashboard fa-lg"></i> Dashboard
                  </a>
                </li>

                <a href="{% url 'getPrescriptionReportPage' %}">
                  <li data-toggle="collapse" data-target="#service" class="collapsed active">
                  <i class="fa fa-user fa-lg"></i> Reports
                </li> 
                </a>
                <a href="{% url 'seePrescription' %}">
                  <li data-toggle="collapse" data-target="#service" class="collapsed ">
                  <i class="fa fa-user fa-lg"></i> Prescription 
                </li> 
                </a>                   
            </ul>
     </div>
</div>

<div class="mainContainer">
  
  <div class="leftSection">
      
      <div class="formContainer">
    
      <div class="container">
    <div class="row col-md-12 col-md-offset-5 custyle">
    <table id="soldMedicineTabel" class="table table-striped custab">
    <thead>
    <!-- <a href="#" class="btn btn-primary btn-xs pull-right"><b>+</b> Add new categories</a> -->
    <h4>Taken medicine from various store</h4>
    
    
        <tr>
            
            <th>Medicine Name</th>
            <th>Store Name</th>
            <th>Date</th>
            <th>Quantity</th>
            <th class="text-center">Action</th>
        </tr>
    </thead>
            {% comment %} <tr>
                
                <td>Antibiotic</td>
                <td>Antibiotic</td>
                <td>Antibiotic</td>
                <td>19</td>
                <td class="text-center"><a class='btn btn-info btn-xs' href="#"><span class="glyphicon glyphicon-edit"></span> Report</a></td>
            </tr> {% endcomment %}
            {% comment %} <tr>
                <td>Y</td>
                <td>Pain Killer</td>
                <td>19</td>
                <td class="text-center"><a class='btn btn-info btn-xs' href="#"><span class="glyphicon glyphicon-edit"></span> Deteils</a></td>
            </tr>
            <tr>
                <td>Z</td>
                <td>Paracetamol</td>
                <td>19</td>
                <td class="text-center"><a class='btn btn-info btn-xs' href="#"><span class="glyphicon glyphicon-edit"></span> Details</a></td>
            </tr> {% endcomment %}
    </table>
    </div>
</div>
</div>
  </div>
  {% comment %} <div class="rightSection">
      
        <div class="container mb-5 mt-5">
            <div class="pricing card-deck flex-column flex-md-row mb-3">
                <div class="card card-pricing text-center px-3 mb-4">
                    <span class="h6 w-60 mx-auto px-4 py-1 rounded-bottom bg-primary text-white shadow-sm">Details</span>
                    <div class="bg-transparent card-header pt-4 border-0">
                      <h5 class="h5 font-weight-normal text-primary text-left mb-0">Patient Name: <span></span></h5><hr>
                        <h5 class="h5 font-weight-normal text-primary text-left mb-0">Medicine Name: <span></span></h5><hr>
                        <h5 class="h5 font-weight-normal text-primary text-left mb-0">Medicine Type: <span></span></h5><hr>
                        <h5 class="h5 font-weight-normal text-primary text-left mb-0">Store Name: <span></span></h5><hr>
                        <h5 class="h5 font-weight-normal text-primary text-left mb-0">Pharmacist Phone: <span></span></h5><hr>
                        <h5 class="h5 font-weight-normal text-primary text-left mb-0">Date: <span></span></h5><hr>
                        <h5 class="h5 font-weight-normal text-primary text-left mb-0">Quantity: <span></span></h5>
                    </div>
                  <div class="card-body pt-0">
                        <ul class="list-unstyled mb-4">
                            
                        </ul>
                        <button type="button" class="btn btn-outline-secondary mb-3">Report</button>
                  </div>
                </div>
            </div>
        </div>
        
        
       
</div> {% endcomment %}

  </div>
  

</div>
 </div>

 <script>

      class SoldMedicineInfoClass{
        constructor(soldMedicineId,pharmacist,prescribedMedicine,medicineQuantity,soldDate){
          this.soldMedicineId=soldMedicineId
          this.pharmacist=pharmacist
          this.prescribedMedicine=prescribedMedicine
          this.medicineQuantity=medicineQuantity
          this.soldDate=soldDate

        }
      }
      class PharmacistClass{
        constructor(pharmacistId,storeName){
          this.pharmacistId=pharmacistId
          this.storeName=storeName
        }
      }
      class PrescribedMedicineClass{
        constructor(prescribedMedicineId,prescribedMedicineMedicine){
          this.prescribedMedicineId=prescribedMedicineId
          this.prescribedMedicineMedicine=prescribedMedicineMedicine
        }
      }
      class MedicineClass{
        constructor(medicineId,medicineName){
          this.medicineId=medicineId
          this.medicineName=medicineName
        }
      }
      var SoldMedicineInfoClassArray = new Array();

      function getSoldMedicine(){
        console.log("ggg")
        var soldMedicine=null;
        $.ajax({
          url: '{% url "getSoldMedicineOnPatietnId" %}',
          async: false,
          data:{

          },
          success: function(data){
              soldMedicine= JSON.parse(data.soldMedicne)
          }
        });
        return soldMedicine;
      }

      //get pharmacist info
      function getPharmacist(pharmacistId){
        console.log("pharmacist")
        var pharmacist=null;
        $.ajax({
          url: '{% url "getPharmacistOnId" %}',
          async:false,
          data: {
            pharmacistId: pharmacistId
          },
          success: function(data){
             pharmacist=JSON.parse(data.pharmacist)
          }
        });
        return pharmacist;
      }

      //get soldMedicine's prescribedMedicine
      function getPrescribedMedicineMedicineOnId(prescribedMedicineId){
          var prescribedMedicineMedicine=null;
          $.ajax({
            url: '{% url "getPrescribedMedicineMedicineOnId" %}',
            async:false,
            data:{
              prescribedMedicineId:prescribedMedicineId
            },
            success: function(data){
              prescribedMedicineMedicine=JSON.parse(data.prescribedMedicineMedicine)
            }
          });
          return prescribedMedicineMedicine;
      }

      function reportSoldMedicine(soldMedicineId,reportComent,pharmacistId){
          $.ajax({
            url: "{% url 'reportSuspiciousSoldMedicine' %}",
            data:{
              soldMedicineId:soldMedicineId,
              reportComent:reportComent,
              pharmacistId:pharmacistId
            },
            success: function(data){

            }
          });
      }

      //click function for report button
      function onClickForReportButton(id){
          for(index in SoldMedicineInfoClassArray){
            if(id==SoldMedicineInfoClassArray[index].soldMedicineId){
              reportSoldMedicine(id,"I am not aware about this sell",SoldMedicineInfoClassArray[index].pharmacist.pharmacistId);
            }
          }
      }
      $("document").ready(function(){
          var soldMedicine=getSoldMedicine();
          for(index in soldMedicine){
            var soldMedicineId=soldMedicine[index].pk
            var pharmacistId=soldMedicine[index].fields.pharmacist
            console.log("pharmacist id "+pharmacistId)
            var pharmacist=null;
            for(index in SoldMedicineInfoClassArray){
              if(pharmacistId==SoldMedicineInfoClassArray[index].pharmacist.pharmacistId){
                  pharmacist=SoldMedicineInfoClassArray[index].pharmacist;
                  break;
              }
            }
            if(pharmacist==null){
                var pharmacist=getPharmacist(pharmacistId)
                for(pIndex in pharmacist){
                  var pharmacistId=pharmacist[pIndex].pk
                  var storeName= pharmacist[pIndex].fields.storeName
                  pharmacist=new PharmacistClass(pharmacistId,storeName)

                }
            }
            
            
            var medicineQuantity = soldMedicine[index].fields.medicineQuantity
            var soldDate = soldMedicine[index].fields.soldDate
            var prescribedMedicineId=soldMedicine[index].fields.prescribedMedicine
            var prescribedMedicine;
            var prescribedMedicineMedicine=null;
            for(index in SoldMedicineInfoClassArray){
              if(prescribedMedicineId==SoldMedicineInfoClassArray[index].prescribedMedicine.prescribedMedicineId){
                  prescribedMedicineMedicine=SoldMedicineInfoClassArray[index].prescribedMedicine.prescribedMedicineMedicine;
                  break;
              }
            }
            if(prescribedMedicineMedicine==null){
              console.log("get medici")
              var medicine=getPrescribedMedicineMedicineOnId(prescribedMedicineId);
              for(index in medicine){
                var medicineId= medicine[index].pk
                var medicineName=medicine[index].fields.medicineName
                console.log("get medici11 "+medicineName)
                prescribedMedicineMedicine = new MedicineClass(medicineId,medicineName)
                console.log(" added medii "+prescribedMedicineMedicine.medicineName)

              }
            }
            prescribedMedicine= new PrescribedMedicineClass(prescribedMedicineId,prescribedMedicineMedicine)
            
            soldMedicineInfoClassObject = new SoldMedicineInfoClass(soldMedicineId,pharmacist,prescribedMedicine,medicineQuantity,soldDate)
            SoldMedicineInfoClassArray.push(soldMedicineInfoClassObject)
            console.log("Quantity"+SoldMedicineInfoClassArray[0].medicineQuantity)

          }
          for(index in SoldMedicineInfoClassArray){
            $("#soldMedicineTabel").append("<tr><td>"+SoldMedicineInfoClassArray[index].prescribedMedicine.prescribedMedicineMedicine.medicineName+"</td><td>"+SoldMedicineInfoClassArray[index].pharmacist.storeName+"</td><td>"+SoldMedicineInfoClassArray[index].soldDate+"</td><td>"+SoldMedicineInfoClassArray[index].medicineQuantity+"</td><td class='text-center'><a onclick='onClickForReportButton(this.id)' id='"+SoldMedicineInfoClassArray[index].soldMedicineId+"'class='btn btn-info btn-xs' href='#'><span class='glyphicon glyphicon-edit'></span> Report</a></td></tr>")
          }

      });

 </script>
    
 {% endblock content %}