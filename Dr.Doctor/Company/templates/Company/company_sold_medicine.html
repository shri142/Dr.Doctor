{% extends "Company/base.html" %}
{% block content %}
	<style type="text/css">

  #soldMedicineTabel{
    display: block;
      overflow-x: auto;
      overflow-y: auto;
        height:370px;
        width:710px;
      white-space: nowrap;
  }
		.nav-side-menu {
  overflow: auto;
  font-family: verdana;
  font-size: 12px;
  font-weight: 200;
  background-color: #2e353d;
  position: fixed;
  top: 0px;
  width: 300px;
  height: 100%;
  color: #e1ffff;
}
.nav-side-menu .brand {
  background-color: #23282e;
  line-height: 50px;
  display: block;
  text-align: center;
  font-size: 14px;
}
.nav-side-menu .toggle-btn {
  display: none;
}
.nav-side-menu ul,
.nav-side-menu li {
  list-style: none;
  padding: 0px;
  margin: 0px;
  line-height: 35px;
  cursor: pointer;
  /*    
    .collapsed{
       .arrow:before{
                 font-family: FontAwesome;
                 content: "\f053";
                 display: inline-block;
                 padding-left:10px;
                 padding-right: 10px;
                 vertical-align: middle;
                 float:right;
            }
     }
*/
}
.nav-side-menu ul :not(collapsed) .arrow:before,
.nav-side-menu li :not(collapsed) .arrow:before {
  font-family: FontAwesome;
  content: "\f078";
  display: inline-block;
  padding-left: 10px;
  padding-right: 10px;
  vertical-align: middle;
  float: right;
}
.nav-side-menu ul .active,
.nav-side-menu li .active {
  border-left: 3px solid #d19b3d;
  background-color: #4f5b69;
}
.nav-side-menu ul .sub-menu li.active,
.nav-side-menu li .sub-menu li.active {
  color: #d19b3d;
}
.nav-side-menu ul .sub-menu li.active a,
.nav-side-menu li .sub-menu li.active a {
  color: #d19b3d;
}
.nav-side-menu ul .sub-menu li,
.nav-side-menu li .sub-menu li {
  background-color: #181c20;
  border: none;
  line-height: 28px;
  border-bottom: 1px solid #23282e;
  margin-left: 0px;
}
.nav-side-menu ul .sub-menu li:hover,
.nav-side-menu li .sub-menu li:hover {
  background-color: #020203;
}
.nav-side-menu ul .sub-menu li:before,
.nav-side-menu li .sub-menu li:before {
  font-family: FontAwesome;
  content: "\f105";
  display: inline-block;
  padding-left: 10px;
  padding-right: 10px;
  vertical-align: middle;
}
.nav-side-menu li {
  padding-left: 10px;
  border-left: 3px solid #2e353d;
  border-bottom: 1px solid #23282e;
}
.nav-side-menu ul a {
  text-decoration: none;
  color: #e1ffff;
}
.nav-side-menu li a i {
  padding-left: 10px;
  width: 20px;
  padding-right: 20px;
}
.nav-side-menu li:hover {
  border-left: 3px solid #d19b3d;
  background-color: #4f5b69;
  -webkit-transition: all 1s ease;
  -moz-transition: all 1s ease;
  -o-transition: all 1s ease;
  -ms-transition: all 1s ease;
  transition: all 1s ease;
}
.head{

	overflow: hidden;
	background-color: currentColor;
	//position: fixed;
	width: 100%;
	height: 50px;
	//margin-left: 300px;
}
.header-right{
	float: right;
}
#logoutButton{
  height: 50px;
}
.headDropdown{
	color: #EEE;
    background: transparent;
	width: 152px;
	height: 49px;
}
.headDropdown option {
    margin: 40px;
    background: #2e353d;
    color: #fff;

}
.mainContainer{
  background: transparent;
  
  margin-left: 300px;
}
.formContainer{
  background: ;
  float: left;
  //box-shadow: 0 9px 9px silver;
  margin: 0 auto;
  padding-bottom: 33px;
  padding-top: 5px;
  width: 824px;

}
.custab{
    border: 1px solid #ccc;
    padding: 5px;
    margin: 5% 0;
    box-shadow: 3px 3px 2px #ccc;
    transition: 0.5s;
    }
.custab:hover{
    box-shadow: 3px 3px 0px transparent;
    transition: 0.5s;
    }
    .container{
      background: transparent;
    }
    .rightSection{
      background: ;
      float: right;
      width: 424px;
      height: 366px;
      margin: 0 auto;
      padding: 9px;
    }
    .rightSection .container{
      background: ;
      box-shadow: 0 9px 9px silver;
    }
    //switch start

  

//switch end

@media (max-width: 767px) {
  .nav-side-menu {
    position: relative;
    width: 100%;
    margin-bottom: 10px;
  }
  .nav-side-menu .toggle-btn {
    display: block;
    cursor: pointer;
    position: absolute;
    right: 10px;
    top: 10px;
    z-index: 10 !important;
    padding: 3px;
    background-color: #ffffff;
    color: #000;
    width: 40px;
    text-align: center;
  }
  .brand {
    text-align: left !important;
    font-size: 22px;
    padding-left: 20px;
    line-height: 50px !important;
  }
  .mainContainer{
    margin-left: 0px;
  }
}
@media (min-width: 767px) {
  .nav-side-menu .menu-list .menu-content {
    display: block;
  }
}
body {
  margin: 0px;
  padding: 0px;
}

	</style>

	<link href="bootstrap.min.css" rel="stylesheet" id="bootstrap-css">

<!------ Include the above in your HEAD tag ---------->

<link href="font-awesome.min.css" rel="stylesheet">

<div class="pageContainer">
    <div class="head">
  <div class="header-right">

        <a href="{% url 'logout' %}"  id="logoutButton" class="btn btn-danger btn-lg">Logout</a>

  </div>
  
</div>
<div class="nav-side-menu">
    <div class="brand">E Prescription</div>
    <i class="fa fa-bars fa-2x toggle-btn" data-toggle="collapse" data-target="#menu-content"></i>
  
        <div class="menu-list">
  
            <ul id="menu-content" class="menu-content collapse out">
              <a href="">
                <li class="">
                  
                  <i class="fa fa-dashboard fa-lg"></i> Company Dashboard
                
                </li>
                  </a>

                <a href="{% url 'medicineList' %}">
                  <li  data-toggle="collapse" data-target="#products" class="collapsed">
                 <i class="fa fa-user fa-lg"></i> Medicine List
                </li>
                </a>

                <a href="{% url 'addmedicine' %}">
                  <li  data-toggle="collapse" data-target="#products" class="collapsed ">
                  <i class="fa fa-user fa-lg"></i> Add Medicine
                </li>
                </a>
                
                <a href="{% url 'viewOrder' %}">
                  <li  data-toggle="collapse" data-target="#products" class="collapsed ">
                  <i class="fa fa-user fa-lg"></i> Medicine Order
                </li>
                </a>


                

                <a href="{% url 'soldMedicines' %}">
                  <li data-toggle="collapse" data-target="#service" class="collapsed active">
                  <i class="fa fa-user fa-lg"></i> Sold Medicine 
                </li>
                </a>
              
                
                
             
            </ul>
     </div>
</div>

<div class="mainContainer">
  
  <div class="leftSection">
      
      <div class="formContainer">
    
      <div class="container">
   		{% comment %} <b>Search By Antibiotic Type</b><br><select class="form-control col-sm-7">
                     <option value="null">
                     --All Type--
                     </option>
                     {% for antibioticType in antibioticTypes %}
                      <option value="{{antibioticType.antibioticTypeId}}">{{antibioticType.antibioticTypeName}}</option>
                     {% endfor %}
                                            
			</select> {% endcomment %}
    <div class="row col-md-12 col-md-offset-5 custyle">
    		
    <table id="soldMedicineTabel" class="table table-striped custab">
    <thead>
    <!-- <a href="#" class="btn btn-primary btn-xs pull-right"><b>+</b> Add new categories</a> -->
    <h4>Sold medicine without prescription by various Store</h4>
    
    
        <tr>
            <th>Medicine Name</th>
            <th>Medicien type</th>
            <th>Quantity</th>
            <th>Store Name</th>
            <th>Pharmecist Phone Number</th>
            {% comment %} <th class="text-center">Action</th> {% endcomment %}
        </tr>
    </thead>
            {% comment %} <tr>
                <td>X</td>
                <td>Antibiotic</td>
                <td>19</td>
                <td>Antibiotic</td>
                <td>19</td>
                <td class="text-center"><a class='btn btn-info btn-xs' href="#"><span class="glyphicon glyphicon-edit"></span> Details</a></td>
            </tr> {% endcomment %}
            
    </table>
    </div>
</div>
</div>
  </div>
  {% comment %} <div class="rightSection">
      
        <div class="container mb-5 mt-5">
            <div class="pricing card-deck flex-column flex-md-row mb-3">
                <div class="card card-pricing text-center px-3 mb-4">
                    <span class="h6 w-60 mx-auto px-4 py-1 rounded-bottom bg-primary text-white shadow-sm">Details</span>
                    <div class="bg-transparent card-header pt-4 border-0">
                        <h5 class="h5 font-weight-normal text-primary text-left mb-0">Medicine Name: <span></span></h5><hr>
                        <h5 class="h5 font-weight-normal text-primary text-left mb-0">Medicine Type: <span></span></h5><hr>
                        

                        <h5 class="h5 font-weight-normal text-primary text-left mb-0">Store Name: <span></span></h5><hr>
                        <h5 class="h5 font-weight-normal text-primary text-left mb-0">Pharmacist Phone: <span></span></h5><hr>
                        <h5 class="h5 font-weight-normal text-primary text-left mb-0">Quantity: <span></span></h5>
                    </div>
                  <div class="card-body pt-0">
                        <ul class="list-unstyled mb-4">
                            
                        </ul>
                        <!-- <button type="button" class="btn btn-outline-secondary mb-3"></button> -->
                  </div>
                </div>
            </div>
        </div>
        
        
       
</div> {% endcomment %}

  </div>
  

</div>
 </div>
    <script>

      class SoldMedicineInfoClass{
        constructor(soldMediicneId, medicine,pharmacist,quantity){
          this.soldMedicineId=soldMediicneId;
          this.medicine=medicine;
          this.pharmacist=pharmacist;
          this.quantity=quantity;
        }
      }
      class PharmacistClass{
        constructor(pharmacistId,pharmacistStoreName,pharmacistPhoneNumber){
          this.pharmacistId=pharmacistId;
          this.pharmacistStoreName=pharmacistStoreName;
          this.pharmacistPhoneNumber=pharmacistPhoneNumber;
        }
      }
      class MedicineClass{
        constructor(medicineId,medicineName,medicineType){
          this.medicineId=medicineId;
          this.medicineName=medicineName;
          this.medicineType=medicineType;
        }
      }
      class MedicineTypeClass{
        constructor(typeId,typeName){
          this.typeId=typeId;
          this.typeName=typeName;
        }
      }
      var soldMedicinesClassArray= new Array();
      var medicineClassArray= new Array();
      var medicineTypeClassArray= new Array();
      var pharmacistClassArray= new Array();

      function getSoldMedicineWithoutPrescription(){
        var soldMedicines;
        $.ajax({
            url: "getSoldMedicineWithoutPrescription",
            async: false,
            data: {
              medicineType: "Non-Antibiotic"
            },
            success: function(data){
              soldMedicines=JSON.parse(data.soldMedicineWithoutPrescription)
              for(soldMedicine in soldMedicines){
                console.log("    "+soldMedicines[soldMedicine].fields.quantity)
              }

            }
        });
        return soldMedicines;
      }

      function getMedicineOnId(medicineId){
        console.log("getMedicineOnId "+medicineId)
        var medicine=null;
        $.ajax({
          url: "getMedicineOnId",
          async: false,
          data: {
            medicineId: medicineId
          },
          success: function(data){
            medicine = JSON.parse(data.medicine)
          }
        });
        return medicine;

      }

      function getMedicineTypeOnId(medicineTypeId){
        var medicineType=null;
        $.ajax({
          url: "getMedicineTypeOnId",
          async: false,
          data: {
            medicineTypeId: medicineTypeId
          },
          success: function(data){
            medicineType = JSON.parse(data.medicineType)
          }
        });
        return medicineType;
      }

      function getPharmacistOnId(pharmacistId){
        var pharmacist=null;
        $.ajax({
          url: "getPharmacistOnId",
          async: false,
          data: {
            pharmacistId: pharmacistId
          },
          success: function(data){
            pharmacist = JSON.parse(data.pharmacist)
          }
        });
        return pharmacist;

      }

      $("document").ready(function(){
        var soldMedicines =getSoldMedicineWithoutPrescription();
        
        //console.log("medicine "+soldMedicines)
        for(soldMedicine in soldMedicines)
        {
          //console.log("medicine22 "+medicine)
              var id = soldMedicines[soldMedicine].pk
              var quantity = soldMedicines[soldMedicine].fields.quantity
              var medicineId = soldMedicines[soldMedicine].fields.medicine
              var medicine=null;
              console.log("medicine "+id)
              for(medicineA in soldMedicinesClassArray)
              {
                if(medicineId==soldMedicinesClassArray[medicineA].medicine.medicineId)
                {
                  medicine=soldMedicinesClassArray[medicineA].medicine
                  break;
                }
              }
              if(medicine==null)
              {
                console.log("medicine null "+medicine)
                medicines= getMedicineOnId(medicineId);
                for(medicineIndex in medicines)
                {
                  var medicineId = medicines[medicineIndex].pk
                  var medicineName = medicines[medicineIndex].fields.medicineName
                  var typeId = medicines[medicineIndex].fields.type
                  var type=null;
                  for(typeIndex in soldMedicinesClassArray)
                  {
                      if(typeId==soldMedicinesClassArray[typeIndex].medicine.medicineType.medicineTypeId)
                      {
                        type=soldMedicinesClassArray[typeIndex].medicine.medicineType
                        break;
                      }
                  }
                  console.log("medicine2 "+type)
                  if(type==null)
                  {
                    type = getMedicineTypeOnId(typeId);
                    for(ty in type)
                    {
                      var typeId=type[ty].pk
                      var typeName=type[ty].fields.medicineTypeName
                      type = new MedicineTypeClass(typeId,typeName);
                      console.log("medicine2 "+type.typeName)
                      
                    }
                  }
                  
                
              }
              medicine=new MedicineClass(medicineId,medicineName,type);
               
            
            }
            var pharmacistId=soldMedicines[soldMedicine].fields.pharmacist
            var pharmacist = null;
            console.log("phar log "+pharmacist)
            for(pharmacistIndex in soldMedicinesClassArray)
            {
              console.log("phar log")
              if(pharmacistId==soldMedicinesClassArray[pharmacistIndex].pharmacist.pharmacistId)
              {
                pharmacist=soldMedicinesClassArray[pharmacistIndex].pharmacist;
                break;
              }
            }
            if(pharmacist==null)
            {
              console.log("phar log22222 id: "+pharmacistId)

              pharmacists= getPharmacistOnId(pharmacistId);
              for(pharma in pharmacists)
              {
                
                var pharmacistId=pharmacists[pharma].pk
                console.log("phar log"+pharmacistId)
                var pharmacistStoreName=pharmacists[pharma].fields.storeName
                var pharmacistPhoneNumber=pharmacists[pharma].fields.phoneNumber
                pharmacist= new PharmacistClass(pharmacistId,pharmacistStoreName,pharmacistPhoneNumber)
              }
            }

            soldMedicineObject=new SoldMedicineInfoClass(id,medicine,pharmacist,quantity);
           
            soldMedicinesClassArray.push(soldMedicineObject)
            console.log("last log"+soldMedicinesClassArray[0].quantity)
            
            

        }

        for(index in soldMedicinesClassArray){
            //add info in tabel
            $("#soldMedicineTabel").append("<tr><td>"+soldMedicinesClassArray[index].medicine.medicineName+"</td><td>"+soldMedicinesClassArray[index].medicine.medicineType.typeName+"</td><td>"+soldMedicinesClassArray[index].quantity+"</td><td>"+soldMedicinesClassArray[index].pharmacist.pharmacistStoreName+"</td><td>"+soldMedicinesClassArray[index].pharmacist.pharmacistPhoneNumber+"</td></tr>");
        }

        
        


            


      });
    </script>
{% endblock content %}